---
title: HW4 Qb-Qd
author: Suheng Yao
date: September 24, 2024
output: pdf_document
---

### Question b

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
combined_data[combined_data==99 | combined_data==999] <- NA
print(head(combined_data))
```
It may not be always appropriate to convert 99 or 999 to NA because sometimes 99 or 999 could be meaningful data points, and converting them to NA will cause data loss and affect the model's performance. Also, some missing values are in the columns with only character or factor values, converting them directly with NA may not be helpful with further data cleaning steps.
Further analysis on the pattern of NA:
```{r}
total_missing <- sum(is.na(combined_data)) # find the total number of missing value in data
print(total_missing)
missing_col <- colSums(is.na(combined_data)) # find the number of missing values in each column
print(missing_col)

# find the percentage of missing values in each column
missing_percent <- (colSums(is.na(combined_data))/nrow(combined_data)) * 100
print(missing_percent)
```
```{r}
barplot(missing_percent, main = "Percentage Missing in Each Column",
        ylab = "Percentage of Missing Values", las=2)
```
The graph shows that there are a lot of missing values in VIS and TIDE variables. In most of the datasets from 1985 to 2023, the station visibility data(VIS) is filled with 99, and only starting from 2000, the TIDE variable had been added to the data. So VIS and TIDE tend to have a lot of missing values. Also, MWD(Wave Measurements), WD(Wind Directions) and BAR(Pressure) get a lot of missing values because WD and BAR are all old metrics, and the station stop using those labels long time ago, adn for MWD, the reason could be related to that the wave measurements are not directly measured by sensors on board the buoys.

### Question C
```{r}
library(ggplot2)
library(dplyr)
ggplot(combined_data, aes(x = DateTime, y = ATMP)) +
  geom_line(colour = "red") +
  labs(x = "Datetime", y = "Celsius", title = "Air Temperature Change Over Time") +
  theme_minimal()

ggplot(combined_data, aes(x = DateTime, y = WTMP)) +
  geom_line(colour = "blue") +
  labs(x = "Datetime", y = "Celsius", title = "Sea Surface Temperature Change Over Time") +
  theme_minimal()

mean_year_air <- combined_data %>%
  mutate(Year = as.integer(format(DateTime, "%Y"))) %>%
  group_by(Year) %>%
  summarise(mean_atmp = mean(ATMP, na.rm = TRUE))
print(mean_year_air)

mean_year_sea <- combined_data %>%
  mutate(Year = as.integer(format(DateTime, "%Y"))) %>%
  group_by(Year) %>%
  summarise(mean_wtmp = mean(WTMP, na.rm = TRUE))
print(mean_year_sea)
```
After drawing the ATMP(Air Temperature) and WTMP(Sea Surface Temperature) change over time, I can clearly see that temperature in 2023 is much higher than temperature in 1985, indicating that the climate change is a real issue. Also, from the mean air and sea surface temperature calculated each year, the average temperature in 2023 is clearly higher than 1985, indicating both temperature are rising.

### Question d

